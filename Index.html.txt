<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FocusScore - Practice with Purpose</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        // Constants & Themes
        const THEMES = [
            { name: 'Indigo', color: 'bg-indigo-600', text: 'text-indigo-600', border: 'border-indigo-600', light: 'bg-indigo-50' },
            { name: 'Rose', color: 'bg-rose-600', text: 'text-rose-600', border: 'border-rose-600', light: 'bg-rose-50' },
            { name: 'Amber', color: 'bg-amber-600', text: 'text-amber-600', border: 'border-amber-600', light: 'bg-amber-50' },
            { name: 'Emerald', color: 'bg-emerald-600', text: 'text-emerald-600', border: 'border-emerald-600', light: 'bg-emerald-50' },
            { name: 'Midnight', color: 'bg-slate-950', text: 'text-slate-950', border: 'border-slate-950', light: 'bg-slate-200' }
        ];

        const PEDAGOGY_VAULT = [
            { category: "Rhythm & Tempo", details: ["Metronome subdivisions", "Rhythmic variants", "Tempo ramp-up"] },
            { category: "Technique", details: ["Isolation of hurdles", "Weight transfer", "Touch uniformity"] },
            { category: "Memory", details: ["Harmonic analysis", "Mental visualization", "Random start points"] }
        ];

        // Global State
        let pieces = [];
        let selectedPieceId = null;

        // Initialize App
        function init() {
            loadPieces();
            renderThemes();
            renderVault();
            lucide.createIcons();
        }

        // Local Storage Functions
        function savePieces() {
            localStorage.setItem('pieces', JSON.stringify(pieces));
        }

        function loadPieces() {
            const stored = localStorage.getItem('pieces');
            if (stored) pieces = JSON.parse(stored);
            if (pieces.length === 0) {
                createNewPiece("First Project");
            }
            if (!selectedPieceId && pieces.length > 0) selectedPieceId = pieces[0].id;
            renderSidebar();
            renderContent();
        }

        // Create New Project
        function createNewPiece(title) {
            const newId = Math.random().toString(36).substr(2, 9);
            const newPiece = {
                id: newId,
                title,
                selectedLogId: 'log-1',
                logs: [{
                    id: 'log-1',
                    date: new Date().toISOString().split('T')[0],
                    type: 'practice',
                    nodes: [{ id: 'root', text: title, parentId: null }]
                }]
            };
            pieces.push(newPiece);
            selectedPieceId = newId;
            savePieces();
            renderSidebar();
            renderContent();
        }

        // Render Sidebar
        function renderSidebar() {
            const container = document.getElementById('repertoire-list');
            container.innerHTML = pieces.map(p => `
                <button onclick="selectPiece('${p.id}')" class="w-full text-left p-6 rounded-[32px] border transition-all ${selectedPieceId === p.id ? 'bg-white border-indigo-600 shadow-xl' : 'bg-white/40 border-slate-100 text-slate-400'}">
                    <div class="font-black text-slate-900">${p.title}</div>
                    <div class="text-[9px] font-black uppercase tracking-widest opacity-60">${p.logs.length} Sessions</div>
                </button>
            `).join('');
        }

        // Render Main Workspace
        function renderContent() {
            const piece = pieces.find(p => p.id === selectedPieceId);
            if (!piece) return;

            const log = piece.logs.find(l => l.id === piece.selectedLogId);
            document.getElementById('project-title').innerText = piece.title;

            const nodesContainer = document.getElementById('nodes-container');
            nodesContainer.innerHTML = '';
            const rootNode = log.nodes.find(n => n.id === 'root');
            nodesContainer.appendChild(createNodeElement(rootNode, log.nodes));
            lucide.createIcons();
        }

        // Recursive Node Rendering
        function createNodeElement(node, allNodes) {
            const div = document.createElement('div');
            div.className = "flex flex-col items-start relative mb-8";

            const isRoot = node.id === 'root';
            const children = allNodes.filter(n => n.parentId === node.id);

            div.innerHTML = `
                <div class="flex items-center group">
                    <div class="p-6 rounded-[28px] shadow-sm border bg-white min-w-[300px] ${isRoot ? 'border-indigo-600 border-2' : 'border-slate-100'}">
                        <div class="text-[13px] font-black text-slate-800">${node.text}</div>
                        <div class="flex justify-between items-center mt-3 pt-3 border-t border-slate-50">
                             <span class="text-[9px] uppercase font-black opacity-40">${isRoot ? 'Project' : 'Focus'}</span>
                        </div>
                    </div>
                    <button onclick="addChild('${node.id}')" class="ml-4 p-2 bg-slate-100 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity"><i data-lucide="plus" class="w-4 h-4"></i></button>
                </div>
                <div class="ml-12 pl-8 border-l-2 border-slate-50 mt-4 space-y-4"></div>
            `;

            const childrenContainer = div.querySelector('.space-y-4');
            children.forEach(child => {
                childrenContainer.appendChild(createNodeElement(child, allNodes));
            });

            return div;
        }

        // Window Actions
        function selectPiece(id) {
            selectedPieceId = id;
            renderContent();
            renderSidebar();
        }

        function addChild(parentId) {
            const text = prompt("Action Step Name?");
            if (!text) return;
            const piece = pieces.find(p => p.id === selectedPieceId);
            const log = piece.logs.find(l => l.id === piece.selectedLogId);
            log.nodes.push({ id: Math.random().toString(36).substr(2, 9), text, parentId });
            savePieces();
            renderContent();
        }

        function startApp() {
            const name = document.getElementById('user-name-input').value;
            if (!name) return;
            document.getElementById('onboarding').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
        }

        function renderThemes() {
            const container = document.getElementById('theme-grid');
            container.innerHTML = THEMES.map(t => `
                <div class="w-8 h-8 rounded-full ${t.color} cursor-pointer border-2 border-white shadow-sm hover:scale-110 transition-transform"></div>
            `).join('');
        }

        function renderVault() {
            const container = document.getElementById('vault-list');
            container.innerHTML = PEDAGOGY_VAULT.map(v => `
                <div class="mb-4">
                    <div class="text-[10px] font-black uppercase tracking-widest text-slate-400 mb-2">${v.category}</div>
                    <div class="space-y-1">
                        ${v.details.map(d => `<div class="text-[11px] font-bold p-2 hover:bg-slate-50 rounded-lg cursor-pointer">${d}</div>`).join('')}
                    </div>
                </div>
            `).join('');
        }

        window.onload = init;
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background: #FDFDFF; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="text-slate-900">

    <!-- Onboarding -->
    <div id="onboarding" class="fixed inset-0 bg-white z-[100] flex flex-col items-center justify-center p-6 text-center">
        <div class="w-full max-w-md space-y-10">
            <div class="bg-indigo-600 w-20 h-20 rounded-[28px] flex items-center justify-center text-white shadow-2xl mx-auto rotate-3">
                <i data-lucide="target" class="w-10 h-10"></i>
            </div>
            <h1 class="text-6xl font-black tracking-tighter">FocusScore.</h1>
            <div class="bg-slate-50 p-8 rounded-[40px] border border-slate-100 space-y-4">
                <input id="user-name-input" type="text" placeholder="Enter Artist Name" class="w-full bg-white border-2 border-slate-100 py-4 px-6 text-xl rounded-2xl font-black outline-none focus:border-indigo-500">
                <button onclick="startApp()" class="w-full py-6 bg-indigo-600 text-white rounded-[32px] font-black uppercase tracking-widest shadow-xl flex items-center justify-center gap-3">
                    Enter Studio <i data-lucide="arrow-right"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="main-app" class="hidden min-h-screen flex flex-col">
        <header class="bg-white/80 backdrop-blur-xl border-b border-slate-100 px-10 py-6 flex justify-between items-center sticky top-0 z-50">
            <div class="flex items-center gap-4">
                <div class="bg-indigo-600 w-10 h-10 rounded-xl flex items-center justify-center text-white"><i data-lucide="target" class="w-6 h-6"></i></div>
                <div>
                    <h2 class="text-lg font-black tracking-tighter uppercase leading-none">FocusScore</h2>
                    <p class="text-[8px] font-black uppercase tracking-[0.2em] text-slate-400 mt-1">Practice with Purpose</p>
                </div>
            </div>

            <div class="flex items-center gap-4">
                <div class="w-10 h-10 rounded-xl bg-slate-900 text-white flex items-center justify-center font-black text-xs">U</div>
            </div>
        </header>

        <main class="max-w-[1400px] mx-auto w-full p-10 grid grid-cols-12 gap-10 flex-grow">
            <!-- Sidebar -->
            <aside class="col-span-3 space-y-6">
                <div class="text-[10px] font-black uppercase tracking-widest text-slate-400 px-4">Repertoire</div>
                <div id="repertoire-list" class="space-y-4"></div>
            </aside>

            <!-- Workspace -->
            <section class="col-span-9 bg-white rounded-[48px] border border-slate-100 shadow-2xl overflow-hidden flex flex-col">
                <div class="p-12 border-b border-slate-100 bg-slate-50/30 flex justify-between items-end">
                    <div>
                        <div class="text-indigo-600 flex items-center gap-2 mb-2">
                            <i data-lucide="sparkles" class="w-4 h-4"></i>
                            <span class="text-[10px] font-black uppercase tracking-widest">Mastery Roadmap</span>
                        </div>
                        <h1 id="project-title" class="text-4xl font-black tracking-tighter">Project Name</h1>
                    </div>
                    
                    <!-- Vault -->
                    <div class="relative group">
                        <button class="px-6 py-3 bg-white border border-slate-200 rounded-2xl text-[10px] font-black uppercase tracking-widest flex items-center gap-2">
                            <i data-lucide="library" class="w-4 h-4"></i> Framework
                        </button>
                        <div class="absolute right-0 top-full mt-4 w-72 bg-white shadow-2xl border border-slate-100 rounded-[32px] p-6 opacity-0 pointer-events-none group-hover:opacity-100 group-hover:pointer-events-auto transition-all z-20">
                            <div id="vault-list"></div>
                        </div>
                    </div>
                </div>

                <div id="nodes-container" class="flex-grow p-12 overflow-auto flex items-center justify-center min-h-[500px]">
                    <!-- Mind map injected here -->
                </div>
            </section>
        </main>
    </div>

    <!-- Hidden Theme Picker Template -->
    <div id="theme-grid" class="hidden"></div>
</body>
</html>